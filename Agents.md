# CSIE Web AGENT 指南

## 風格與寫法
- **語言**：所有說明文件與討論請使用繁體中文，保持專業、精簡且具體。
- **命名慣例**：
  - 後端採 Laravel 慣例，Model 使用單數帕斯卡命名（例如 `PostCategory`）、資料表使用複數蛇形命名（例如 `post_categories`）。
  - 前端 React 元件使用帕斯卡命名（例如 `PostListTable`），檔案夾層遵循功能導向：`resources/js/Pages/Admin/<Feature>`。
- **註解原則**：必要時加入繁體中文註解，描述目的與商業規則，避免冗長的流程敘述。
- **翻譯檔**：所有可視文字優先寫入 `resources/lang/{locale}`，使用語系 key 來取值。
- **版面規格**：
  - TailwindCSS 為主要樣式工具；禁止在組件內硬編寫大量自訂 CSS，若需覆寫請以 `@apply` 或客製化 theme。
  - 色票對齊 `#151f54`（主色）、`#ffb401`（輔色）、`#fff809`（強調色）。
- **測試策略**：
  - 後端撰寫 Feature / Unit 測試覆蓋主要流程（CRUD 與權限）。
  - 前端若有複雜互動，撰寫 Inertia component 測試或 Storybook（後續規劃）。

## 管理頁面設計（Admin Area）
> 依據《Arhitectrue.md》規劃的後台模組 `/admin/posts`、`/admin/staff`、`/admin/labs` 為首波重點，以下針對資料流、UI 版型、操作流程進行細部設計。

### 1. 通用結構
- **版型**：沿用 `AppLayout`（含 `AppHeader`、`AppSidebar`、`AdminFooter`）。
  - Header 提供語系切換、使用者資訊（名稱、角色、登出）。
  - Sidebar 依模組列出功能群組：Dashboard（保留）、公告管理、師資管理、實驗室管理、系統設定（預留）。
- **主內容區**：使用 12 栏網格，頂部為頁面標題 + 操作列，下方為內容（表格或表單）。
- **警示/通知**：統一使用 Inertia flash message，成功為綠色 `success`、錯誤顯示於表單欄位。
- **權限控管**：
  - `admin` 全權使用所有模組。
  - `teacher` 僅能進入師資模組並編輯自己資料、關聯實驗室。
- **多語內容編輯**：採分頁 Tab（`zh-TW`、`en`），切換時顯示對應欄位，底層儲存 JSON。

### 2. 公告管理 `/admin/posts`
- **列表頁**：
  - 功能列：`新增公告` 按鈕、分類篩選（Select）、狀態篩選（草稿/已發布）、搜尋（標題關鍵字）。
  - 資料表欄位：
    1. 類別（顯示目前語系名稱）
    2. 標題（語系化顯示）
    3. 發布狀態（草稿/已發布，使用 Badge）
    4. 置頂（是/否圖示）
    5. 發布日期（`published_at`）
    6. 操作（`編輯`、`預覽`、`更多` 下拉含 `複製連結`、`刪除`）
  - 分頁：使用 Laravel paginator，固定每頁 15 筆，可切換頁數。
- **建立/編輯表單**：
  - 左側 `Metadata` 區（佔 4 欄）：
    - 公告類別（Select，多層分類時以樹狀顯示）。
    - 發布狀態（Radio：草稿、已發布）。
    - 發布日期（DateTime picker，預設即時）。
    - 置頂（Switch）。
    - 附件上傳：支援多筆、顯示檔名、大小、下載/刪除。
  - 右側 `Content` 區（佔 8 欄）：
    - Tab `zh-TW` / `en`，各包含標題、摘要、內容（Rich Text 或 Markdown 編輯器）。
    - 內容欄位需支援附件連結插入、表格。
  - 底部操作：`儲存草稿`、`發布`（僅草稿顯示）、`取消` 返回列表。
- **資料驗證**：
  - 標題、類別必填；內容至少一種語言填寫。
  - 上傳檔案類型限制（pdf/doc/png/jpg）與大小（20MB）。
- **流程**：
  1. 儲存時將多語欄位合併成 JSON，附件透過 `Attachment` 模型綁定。
  2. 發布時寫入 `published_at`，Inertia 重新導向列表並顯示成功通知。

### 3. 師資管理 `/admin/staff`
- **列表頁**：
  - 篩選：角色（教授/副教授/助理教授/行政）、狀態（啟用/停用）、所屬實驗室。
  - 表格欄位：頭像縮圖、姓名（多語，優先語系）、職稱、Email、排序值、狀態、操作。
  - 操作含：`編輯基本資料`、`管理個人連結`（開啟 Modal）、`刪除`。
- **編輯表單**：
  - 基本資料：姓名（JSON Tab）、職稱（JSON Tab）、Email、電話、辦公室位置、排序、狀態。
  - 關聯設定：
    - 所屬實驗室（多選，下拉＋搜尋）。
    - 主要實驗室（單選，下拉列出所有實驗室）。
  - 照片：圖片上傳（顯示預覽、裁切 4:5 建議）。
- **個人連結管理（Modal）**：
  - 列出既有連結（標籤多語、URL）。
  - 允許新增/編輯/刪除，每筆儲存前驗證 URL 格式。
- **Teacher Role 權限**：
  - 僅顯示自己的資料，隱藏排序與狀態欄位。
  - 禁止刪除、限制實驗室選擇為自己參與的實驗室。

### 4. 實驗室管理 `/admin/labs`
- **列表頁**：
  - 篩選：狀態（啟用/停用）、主持人（Staff）、關鍵字（實驗室名稱）。
  - 表格欄位：封面縮圖、名稱（語系化）、主持人、網站連結、狀態、更新時間、操作。
- **建立/編輯表單**：
  - 基本資訊（Tab 多語）：名稱、Slug（自動轉換、可手動調整）、簡介（Rich Text/Markdown）、外部網站。
  - 主持人設定：PI（Select Staff）、成員（多選 Staff）。
  - 代表圖片：上傳裁切 16:9，支援拖曳排序（僅一張，後續可擴充圖集）。
  - 狀態切換：啟用/停用，停用時前台不顯示。
- **內容展示預覽**：於表單右上提供 `前台預覽` 連結（僅已儲存資料可用）。

### 5. 系統整合注意事項
- **資料快取**：更新公告/師資/實驗室後，觸發相對應的 cache clear job（後續實作）。
- **審計紀錄（後續）**：所有 CRUD 操作寫入活動日誌，預留 `ActivityLog` 模型。
- **錯誤處理**：後端回傳 422 Validation 時，前端自動將錯誤訊息顯示於對應欄位，下方再以 Alert 彙總。
- **可及性**：表格與按鈕使用語意化 HTML，icon 需搭配 `sr-only` 文案。

---

以上規範適用於 `csie_web` 專案所有後續開發。若有新模組需補充設計，請更新此文件以保持一致性。
