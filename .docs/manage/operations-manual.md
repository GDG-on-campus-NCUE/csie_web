# 系統操作手冊

## 目錄
1. [支援系統操作指南](#支援系統操作指南)
2. [通知系統操作指南](#通知系統操作指南)
3. [管理員操作指南](#管理員操作指南)
4. [常見問題處理](#常見問題處理)
5. [系統維護指南](#系統維護指南)

---

## 支援系統操作指南

### 1. 工單系統（Support Tickets）

#### 1.1 使用者操作

**建立工單**
1. 登入系統後，進入「支援中心」→「我的工單」
2. 點擊「建立工單」按鈕
3. 填寫工單資訊：
   - 標題：簡要描述問題（必填，最多 200 字）
   - 分類：選擇問題類型（account/technical/feature/other）
   - 優先級：選擇緊急程度（low/normal/high/urgent）
   - 訊息：詳細描述問題（必填）
   - 附件：可上傳相關檔案（最多 5 個）
   - 標籤：可新增分類標籤（最多 5 個）
4. 點擊「送出」建立工單
5. 系統會自動生成工單編號（格式：ST-YYYYMMDD-####）

**查看工單**
1. 在「我的工單」列表中可以看到所有自己建立的工單
2. 使用篩選器：
   - 狀態：待處理/處理中/已解決/已關閉
   - 優先級：低/一般/高/緊急
   - 分類：帳號/技術/功能/其他
3. 使用搜尋框輸入關鍵字快速查找

**回覆工單**
1. 點擊工單標題進入詳情頁
2. 在頁面底部「新增回覆」區域輸入訊息
3. 點擊「送出回覆」
4. 可以看到完整的對話歷程（使用者與客服的回覆會有不同標記）

**關閉工單**
1. 當問題解決後，在工單詳情頁點擊「關閉工單」
2. 已關閉的工單將無法再新增回覆
3. 如需重新處理，請建立新工單

**工單狀態說明**
- **待處理（open）**：剛建立，等待客服人員處理
- **處理中（in_progress）**：客服人員正在處理
- **已解決（resolved）**：客服人員已標記為解決，等待使用者確認
- **已關閉（closed）**：問題已解決且使用者已確認

#### 1.2 管理員操作

**查看所有工單**
- 管理員可以查看所有使用者的工單
- 使用篩選器和搜尋功能管理大量工單

**處理工單**
1. 點擊工單進入詳情頁
2. 回覆使用者問題（回覆會標記為「客服回覆」）
3. 更新工單狀態：
   - 開始處理時：更新為「處理中」
   - 問題解決時：更新為「已解決」
4. 如需分配給其他客服人員：在 `assigned_to` 欄位指定

**工單統計與報表**
- 查看工單解決率
- 平均回應時間
- 各分類問題數量統計

### 2. 常見問題（FAQ）

**查看 FAQ**
1. 進入「支援中心」→「常見問題」
2. FAQ 依分類自動分組顯示
3. 可使用搜尋框快速查找
4. 可依分類篩選

**使用 FAQ**
1. 點擊問題標題查看完整答案
2. 系統會自動增加瀏覽次數
3. 底部顯示「相關問題」提供更多參考
4. 如果 FAQ 無法解決問題，可直接點擊「建立支援工單」

**FAQ 管理（管理員）**
1. 建立 FAQ：
   - 設定問題與答案（中英文版本）
   - 選擇分類
   - 設定排序順序
   - 標記為「有幫助」（常用問題）
   - 設定發布狀態
2. 編輯 FAQ：更新內容、調整排序
3. 停用 FAQ：暫時隱藏不適用的問題

---

## 通知系統操作指南

### 1. 通知中心

**查看通知**
1. 點擊頂部導航列的「通知」圖示（🔔）
2. 進入「通知中心」查看所有通知
3. 未讀通知會有藍色邊框高亮顯示

**通知類型**
系統共有 8 種通知類型：
1. **公告發布**：新公告發布時通知
2. **公告更新**：已發布的公告有更新時通知
3. **空間同步失敗**：Space 同步失敗時通知
4. **權限變更**：使用者權限被修改時通知
5. **工單回覆**：支援工單有新回覆時通知
6. **工單已解決**：工單被標記為已解決時通知
7. **實驗室成員新增**：被加入實驗室時通知
8. **計畫里程碑**：研究計畫達成里程碑時通知

**管理通知**
- **標記已讀**：點擊通知右側的「✓」圖示
- **全部標記已讀**：點擊「全部標記已讀」按鈕
- **刪除通知**：點擊通知右側的「✕」圖示
- **清除已讀通知**：點擊「清除已讀」按鈕批次刪除所有已讀通知

**查看通知詳情**
- 點擊通知內容可查看完整訊息
- 點擊「查看」按鈕會跳轉至相關頁面

**通知優先級**
- **緊急（urgent）**：紅色標籤，重要通知
- **高（high）**：橙色標籤
- **一般（normal）**：藍色標籤
- **低（low）**：灰色標籤

### 2. 通知偏好設定

**設定通知接收方式**
1. 進入「設定」→「通知偏好」
2. 針對每種通知類型，可以：
   - 啟用/停用該類型通知
   - 選擇接收頻道：
     - **Email**：發送郵件通知
     - **站內通知（App）**：顯示在通知中心
     - **LINE Bot**：透過 LINE 推播（需先綁定 LINE）

**建議設定**
- **重要通知**（權限變更、工單回覆）：啟用所有頻道
- **一般通知**（公告發布、公告更新）：僅站內通知
- **低優先級**（實驗室成員新增）：視個人需求啟用

**綁定 LINE Bot（待整合）**
1. 進入「設定」→「帳號綁定」
2. 掃描 LINE Bot QR Code
3. 完成綁定後即可接收 LINE 通知

---

## 管理員操作指南

### 1. 公告管理

**發布公告**
1. 進入「管理後台」→「公告管理」
2. 點擊「新增公告」
3. 填寫公告內容：
   - 標題（中英文）
   - 內容（Rich Text 編輯器）
   - 分類（選擇或新建）
   - 標籤（可多選）
   - 附件（可上傳多個）
   - 發布時間（可排程）
   - 可見性（公開/僅登入使用者）
4. 選擇「發佈」或「儲存草稿」

**管理公告**
- 編輯：修改已發布的公告
- 封存：將舊公告封存（不刪除）
- 刪除：永久刪除公告
- 批次操作：選擇多個公告進行批次發佈/封存/刪除

### 2. 使用者管理

**管理使用者帳號**
1. 進入「管理後台」→「使用者管理」
2. 可執行操作：
   - 查看使用者資料
   - 編輯使用者角色（admin/teacher/user）
   - 重設密碼
   - 停權/啟用帳號
   - 模擬登入（impersonate）

**角色權限說明**
- **管理員（admin）**：完整系統權限
- **教師（teacher）**：可管理實驗室、研究計畫、教師公告
- **一般使用者（user）**：基本瀏覽與個人設定權限

### 3. 標籤管理

**管理標籤**
1. 進入「管理後台」→「標籤管理」
2. 可執行操作：
   - 新增標籤（設定名稱、顏色、描述）
   - 編輯標籤
   - 合併標籤（Merge）
   - 拆分標籤（Split）
   - 啟用/停用標籤

**標籤使用統計**
- 查看每個標籤的使用次數
- 最後使用時間
- 關聯的內容數量

### 4. 附件管理

**管理附件**
1. 進入「管理後台」→「附件管理」
2. 可執行操作：
   - 上傳新附件（支援拖放）
   - 查看附件詳情（預覽、metadata）
   - 編輯附件資訊（名稱、描述、標籤）
   - 批次下載
   - 批次刪除

**附件篩選**
- 依檔案類型（圖片/文件/影片）
- 依標籤
- 依 Space
- 依上傳日期

---

## 常見問題處理

### 1. 工單系統問題

**Q: 無法建立工單？**
A: 檢查以下項目：
1. 確認已登入系統
2. 確認標題長度不超過 200 字
3. 確認附件數量不超過 5 個
4. 確認標籤數量不超過 5 個

**Q: 已關閉的工單想重新開啟？**
A: 已關閉的工單無法重新開啟，請建立新工單並在訊息中註明原工單編號。

**Q: 工單回覆沒有收到通知？**
A: 檢查「通知偏好設定」中是否啟用「工單回覆」通知。

### 2. 通知系統問題

**Q: 沒有收到 Email 通知？**
A: 檢查：
1. 通知偏好設定是否啟用 Email 頻道
2. Email 地址是否正確
3. 檢查垃圾郵件資料夾

**Q: 通知太多，如何減少？**
A: 進入「通知偏好設定」，停用不需要的通知類型，或只保留站內通知頻道。

**Q: 如何一次清除所有通知？**
A: 先點擊「全部標記已讀」，再點擊「清除已讀」即可清除所有通知。

### 3. FAQ 系統問題

**Q: FAQ 找不到需要的答案？**
A: 可以：
1. 嘗試不同關鍵字搜尋
2. 切換不同分類瀏覽
3. 查看「相關問題」獲得更多資訊
4. 直接建立支援工單詢問

**Q: 建議新增 FAQ 項目？**
A: 請透過「意見回饋」功能或建立工單告知管理員。

---

## 系統維護指南

### 1. 定期維護作業

**每日檢查**
- 檢查系統錯誤日誌
- 檢查待處理工單數量
- 檢查通知發送狀態

**每週維護**
- 清理過期通知（超過 30 天）
- 清理已關閉的舊工單附件
- 檢查系統效能指標

**每月維護**
- 備份資料庫
- 清理暫存檔案
- 更新 FAQ 內容
- 檢視工單統計報表

### 2. 資料庫維護

**備份**
```bash
# 備份資料庫
php artisan backup:run

# 備份附件
tar -czf attachments_backup_$(date +%Y%m%d).tar.gz storage/app/public/attachments
```

**清理**
```bash
# 清理過期通知
php artisan notifications:clean --days=30

# 清理舊工單
php artisan tickets:archive --days=90

# 最佳化資料庫
php artisan db:optimize
```

### 3. 監控指標

**系統健康度指標**
- 工單平均回應時間：應 < 24 小時
- 工單解決率：應 > 90%
- 通知發送成功率：應 > 99%
- 系統可用性：應 > 99.9%

**告警設定**
- 待處理工單超過 50 個
- 緊急工單超過 12 小時未回應
- 通知發送失敗率 > 5%
- 系統錯誤率 > 1%

### 4. 故障排除

**通知發送失敗**
1. 檢查佇列服務狀態：`php artisan queue:work`
2. 檢查 Email 設定：`config/mail.php`
3. 檢查 Webhook 日誌：`webhook_logs` 表

**工單系統異常**
1. 檢查資料庫連線
2. 檢查附件儲存空間
3. 檢查使用者權限設定

**效能問題**
1. 啟用快取：`php artisan cache:clear && php artisan config:cache`
2. 最佳化資料庫索引
3. 檢查慢查詢日誌

### 5. 緊急聯絡方式

**技術支援**
- Email: tech-support@example.com
- 緊急電話: 0800-123-456
- Slack 頻道: #csie-support

**管理員**
- 系統管理員: admin@example.com
- 資料庫管理員: dba@example.com

---

## 附錄

### A. 系統架構圖
```
使用者 → 前端 (React/Inertia) → Laravel API → 資料庫
                                    ↓
                           通知系統 (Queue)
                                    ↓
                    Email / 站內通知 / LINE Bot
```

### B. 資料庫結構
- `support_tickets`: 工單主表
- `support_ticket_replies`: 工單回覆
- `support_faqs`: 常見問題
- `notifications`: 通知記錄
- `notification_preferences`: 通知偏好設定
- `webhook_logs`: Webhook 發送日誌

### C. API 端點
- `GET /manage/user/support/tickets` - 工單列表
- `POST /manage/user/support/tickets` - 建立工單
- `GET /manage/user/support/tickets/{id}` - 工單詳情
- `POST /manage/user/support/tickets/{id}/reply` - 回覆工單
- `POST /manage/user/support/tickets/{id}/close` - 關閉工單
- `GET /manage/user/support/faqs` - FAQ 列表
- `GET /manage/user/support/faqs/{id}` - FAQ 詳情
- `GET /manage/user/notifications` - 通知列表
- `POST /manage/user/notifications/{id}/mark-as-read` - 標記已讀
- `DELETE /manage/user/notifications/{id}` - 刪除通知

### D. 系統需求
- PHP >= 8.2
- Laravel >= 11.x
- MySQL >= 8.0
- Node.js >= 20.x
- Redis (optional, for queue)

---

**文件版本**: 1.0.0  
**最後更新**: 2025-10-03  
**維護人員**: 系統管理團隊
